\chapter{Methodology}
\label{ch:methodology}

\newpage
\section{Synthetic Techniques}
The synthesis of samples in this work is quite simple and involves the \gls{pyrolysis} of carbon-rich material with the aim of \gls{activation}, i.e. the formation of pores in the semi-graphitic structure. In some cases, \gls{htc} is employed to make the material more susceptible to \gls{activation}.

\subsection{Hydrothermal Carbonisation}
\Gls{htc} is often used in the synthesis of \glspl{turbostratic carbon} to make the precursor easier to activate. The process consists of simply placing a mixture of the precursor (typcially biomass) and water into a sealed vessel and heating to temperatures between 180 and \qty{300}{\degreeCelsius}. The ease of activation is attributed to the solid product, known as \gls{hydrochar}, having a high \ce{O} content and low aromaticity.\citep{Sevilla2011Hydrothermal, Sevilla2009Chemical, Sevilla2009a} Indeed, the interaction with water molecules results in the formation of microspheres with a hydrophobic core and hydrophilic shell; this means that any \gls{porogen} used in a subsequent activation step has much greater contact with these \ce{O}-rich moieties. 

In this work, all \gls{htc} was performed in a teflon-lined stainless steel autoclave and heated using an oven. Ramp rate was consistently set at \qty{5}{\degreeCelsius\per\minute} and the dwell time was \qty{2}{\hour}. Dwell temperature and gravimetric concentration of the precursor/water mixture is dependent upon the experiment; more details can be found in the synthetic sections of the relevant chapters.

\subsection{Activation}
In the context of porous carbon materials, activation is the process of porosity development in carbonaceous material.\citep{Sevilla2014Energy} There is a significant, detailed explanation of activation processes in \ref{pub:review}, \textbf{section 2.1.}. In this work, activation is principally conducted \textit{via} chemical oxidation,\citep{Sevilla2014Energy} that is by the oxidative action of a caustic agent - either \ce{KOH} (chapter \ref{ch:cbs} and \ref{ch:impregnation}) or the self-activation of a polymer containing \ce{Na+} ions (chapter \ref{ch:impregnation}) - on the carbon framework of the precursor. The oxidation of \ce{C} to \ce{CO2} and/or \ce{CO3^2-} results in voids forming in the semi-graphitic structure.\citep{Wang2009High, Wang2012, Otowa1993Production} Further pore-forming processes may include intercalation of free \gls{porogen} ions between graphitic layers,\citep{LozanoCastello2007Carbon} as well as the formation of cross-links between polymeric chains prior to carbonisation.\citep{lin2015preparation, yu2017koh, yu2017one}

The relevance of each of these pore formation processes, as well as the synthetic procedures are described in the relevant chapters, however in all cases activation of the precusor-\gls{porogen} mixture was performed by placing the mixture into an alumina boat, and heating under a flow of dry \ce{N2} (\qty{60}{\cm\cubed\per\minute}) in a tube furnace. Dwell time was consistently \qty{1}{\hour} and ramp rate \qty{3}{\degreeCelsius\per\minute}.

In chapter \ref{ch:cbs} activated carbons were produced from \glspl{ucb} from a range of sources. Full synthetic details can be found in table \ref{tb:cb_synthesis}. In all cases, \qty{2.5}{\gram} \acrshortpl{ucb} were ground in a spice grinder, hydrothermally carbonised with \qty{25}{\cm\cubed} water at \qty{250}{\degreeCelsius} (\qty{5}{\degreeCelsius\per\minute}), held \qty{2}{\hour} then activated for \qty{1}{\hour} with or without \ce{KOH}. After cooling, all samples were washed with \ce{HCl} for at least \qty{24}{\hour}, then filtered and washed with water to give neutral washings. Sample designation is h\textit{A-xTTT}, where \textit{A} is the sample prefix (see table \ref{tb:cb_synthesis}), \textit{x} is KOH:\acrshort{ucb} ratio (wt./wt.), and \textit{TTT} is activation temperature in \unit{\degreeCelsius}. A portion of each self activated (i.e. $x = 0$) sample in sets C and D was left unwashed to determine the efficacy of the final washing step. These are indicated with $'$, for example hC-0800$'$ indicates a sample activated at \qty{800}{\degreeCelsius} in the absence of \gls{activating agent}, which was not washed. To refer to the \gls{hydrochar} itself, the designation is h\textit{A}-hydrochar, e.g. \gls{hydrochar} derived from subset hD (see table \ref{tb:cb_synthesis}) is hD-hydrochar.

\begin{table}[t]
    \caption{Synthetic details of samples derived from cigarette butts.}
    \label{tb:cb_synthesis}
    \begin{tabularx}{\textwidth}{lXXl}
        \toprule
            \textbf{Prefix} & \textbf{Preparation} & \textbf{T / \unit{\degreeCelsius}} & \textbf{\# Samples} \\ 
        \midrule
            \textbf{hC}     & From public ash tray; Ash, excess tobacco removed before grinding. \Gls{hydrochar} washed with \qty{0.5}{\dm\cubed} water.              & \numlist[list-final-separator={, }]{600;700;800} & 9              \\
            \textbf{hD}     &  From public ash tray; Ash, excess tobacco removed before grinding.             & \numlist[list-final-separator={, }]{600;700;800} & 9             \\
            \textbf{hE}     & Single brand from single smoker. Paper, ash, excess tobacco removed before grinding              & \numlist[list-final-separator={, }]{600;700;800} & 3              \\
        \bottomrule
    \end{tabularx}%
\end{table}

Sawdust-derived carbons were made in chapter \ref{ch:impregnation} by incorporating \ce{KOH} at weight ratios between \numlist{0.00;2.00} into the \gls{htc} step, drying the resultant slurry overnight at \qty{100}{\degreeCelsius} and then activating at \qty{800}{\degreeCelsius} as usual. \Gls{htc} occured at \qtylist[list-units=single]{200;250;300}{\degreeCelsius}. These sawdust-derived \glspl{hydrochar} are designated SA\textit{x.xx-HHH} where the prefix SA indicates activated sawdust, \textit{x.xx} is the KOH:sawdust ratio and \textit{HHH} is the \gls{htc} temperature. All samples were washed in the normal manner following activation. The hydrothermally carbonised intermediates were also isolated and washed - they are designated  SH\textit{x.xx-HHH} to differentiate them from the activated samples.

Additionally, in chapter \ref{ch:impregnation} sodium carboxymethyl cellulose was used as a precursor for direct (without \gls{htc}) activation.  Samples are designated as NC\textit{x.x-TTT} where \acrshort{nc} indicates sodium carboxymethyl cellulose, \textit{x.x} is the \acrshort{ds}, and \textit{TTT} is the activation temperature. Values for \textit{x.x} were \numlist{0.0;0.7;0.9;1.2} and \textit{TTT} was \qtylist[list-units=single]{600;700;800}{\degreeCelsius}.

\section{Analytical Techniques}
Techniques in this section were employed to understand the composition, structure, and porosity of samples synthesised in this work. They are particularly relevant to chapters \ref{ch:cbs} and \ref{ch:impregnation}. The more precise compositional analysis techniques - \acrfull{xps} and \acrfull{icp-oes} - as well as electron microscopy were only used for samples produced from \acrfullpl{ucb} in chapter \ref{ch:cbs}. Chapters \ref{ch:dual_isotherm} and \ref{ch:pyPUC} rely primarily on analysis of data from porosimetry and gravimetric uptake techniques.

\subsection{Composition and Morphology}

\acrfull{tga} measures the mass of a sample undergoing heating as a function of temperature or time.\citep{coats1963thermogravimetric} \acrshort{tga} was used in this study primarily to determine the \gls{ash content} of samples, thus giving a measure of sample purity,\citep{mcnaught1997compendium} i.e. whether the material contains any non-combustible matter, typically residual metals.

\acrshort{tga} was performed using a TA Q500 Thermogravimetric Analyser. All samples were analysed using a platinum pan and in the presence of air. All experiments took place as follows; temperature was increased at \qty{10}{\degreeCelsius\per\minute} from ambient to \qty{1000}{\degreeCelsius} before dwelling for \qty{10}{\minute}, all the while having an air flow rate of \qty{60}{\cm\cubed\per\minute}.

CHN elemental microanalysis precisely determines the concentration (by weight) of carbon, nitrogen and hydrogen that make up a sample. This is achieved by total combustion of the sample at \qty{975}{\degreeCelsius} under pure oxygen. At this stage impurities such as sulfur, phosphorous, and halogen compounds are also removed \textit{via} various reactions. This results in a pure mixture of \ce{H2O}, \ce{CO2} and oxides of nitrogen, which is transferred by means of a flow of He to a reduction chamber where the nitrogen oxides are reduced to \ce{N2}. This mixture of three sample gases plus the He carrier gas is then equilibrated to precise and constant temperature, volume and pressure. \ce{H2O} and \ce{CO2} are then sequentially separated according to their thermal conductivity, leaving a flow of \ce{N2} and \ce{He}. The volumes of \ce{H2O} and \ce{CO2} can then directly be used to calculate the sample \ce{H} and \ce{C} concentrations. The mixture of \ce{N2} and \ce{He} is compared with a reference flow of pure \ce{He} to determine \ce{N} content.

CHN analysis was performed using an Exeter Analytical CE-440 Elemental Analyzer for the purposes of this work.
% find citation
% particular details of machine.

\acrfull{p-xrd} is principally used to identify elements and determine inter-layer spacing within crystalline powder samples. The latter, $d$ is determined simply according to the angle of diffraction, $\theta$ using the Bragg equation;

\begin{equation}
    n\lambda = 2 d \sin{\theta}
\end{equation}

Where $n$ is the layer number and $\lambda$ the wavelength of X-rays used.\citep{woolfson1997introduction} In the case of unordered \glspl{turbostratic carbon} and \glspl{hydrochar} \acrshort{p-xrd} is used to determine the extent of graphiticity (i.e. how ordered the turbostratic domains are). In addition sharp peaks indicate the presence of crystalline material, which can be attributed to contaminants - typically residual \gls{porogen}.

In this study, \acrshort{p-xrd} measurements were made using a PANalytical X’Pet Pro diffractometer, with \ce{Cu}K\textgreek{α} X-rays of $\lambda$ \qty{1.54}{\angstrom}. Data collection occurred at $2\theta$ between \num{2} and \qty{80}{\degreeCelsius}.

X-ray photoelectron spectra are produced \textit{via} the irradiation of a sample with an X-ray beam, resulting in the ejection of electrons from low energy atomic orbitals according to the photoelectric effect\citep{richardson1912liii}. The electrons are collected and detected by the apparatus, facilitating the elucidation of the identity and quantity of elements present in the material from the kinetic energy of ejected electrons and the number of electrons ejected at each binding energy, respectively. The binding energy, $E_B$ is calculated according to the below equation;

\begin{equation}
    E_B = h\nu - \Phi - E_K
\end{equation}

where $h\nu$ is the photon energy, $\Phi$ is the sample’s work function, and $E_K$ is the kinetic energy of the photoelectron. So-called `shifting' of elemental characteristic binding energies can be used to determine chemical and electronic states of detected species.\citep{moulder1995handbook}

Samples were prepared from selected \glspl{hydrochar} and \glspl{turbostratic carbon} by performing a \acrshort{tga} in air to burn off all carbonaceous material. The remaining inorganic matter was then analysed using the Kratos AXIS ULTRA with a mono-chromated \ce{Al}k\textgreek{α} X-ray source (\qty{1486.6}{\electronvolt}) operated at \qty{10}{\mA} emission current and \qty{12}{\kilo\volt} anode potential (\qty{120}{\watt}). Spectra were acquired with the Kratos VISION II software. A charge neutralizer filament was used to prevent surface charging. Hybrid–slot mode was used measuring a sample area of approximately \qtyproduct{300 x 700}{\micro\metre}. The analysis chamber pressure was better than \qty{5e-9}{\milli\bar}. Three areas per sample were analysed. A wide scan at low resolution (Binding energy range \qtyrange{1400}{-5}{\electronvolt}, with pass energy \qty{80}{\electronvolt}, step \qty{0.5}{\electronvolt}, sweep time \qty{20}{\minute}) was used to estimate the total atomic \% of the detected elements. High resolution spectra at pass energy \qty{20}{\electronvolt}, step of \qty{0.1}{\electronvolt}, and sweep times of \qty{10}{\minute} each were also acquired for photoelectron peaks from the detected elements and these were used to model the chemical composition. The spectra were charge corrected to the C 1s peak set to \qty{285}{\electronvolt}. Casaxps (version 2.3.19 PR1.0) software\citep{fairley2021systematic} was used for quantification and spectral modelling.

Optical Emission Spectrometry (OES), also known as Atomic Emission Spectrometry (AES) is a technique used to quantify concentration of elements in solution by exciting them and measuring intensity of emissions at some characteristic wavelength associated with the return of the species to the ground state. These intensities are then converted to concentrations using a calibration curve. While there are multiple methods to excite the atoms, a common method is using Inductively Coupled Plasma (ICP) which also acts to separate elements in the solution. This technique is thus abbreviated to \acrshort{icp-oes} or ICP-AES.\citep{Hinners1988interlaboratory}

Samples were prepared by dry-ashing in an alumina crucible at \qty{600}{\degreeCelsius} for at least \qty{16}{\hour}, the ash was then digested in an aqueous solution of \qty{10}{\volpercent} each of high purity \ce{HNO3} and \ce{HCl} (Aristar grade). The mixture was then sonicated for several hours, and digestion was completed via microwave, before being centrifuged at \qty{4000}{rpm} for \qty{99}{\minute}. Finally the digestate was filtered through syringe filters to remove any remaining sediment. References and blanks were prepared from the same stock digestion solution to ensure consistency. Standards were made from a 28-element standard (\qty{100}{\mg\per\dm\cubed}, \qty{2}{\volpercent} \ce{HNO3} matrix from Fisher) at concentrations of \qtylist[list-units = single]{0.1;1;10;50;100}{\mg\per\dm\cubed}. Measurements were made using a Perkin-Elmer Optima 2000 Spectrometer, using argon plasma.

Electron microscopy was used on the samples in chapter \ref{ch:cbs} in order to determine sample morphology as well as composition and dispersion of inorganic heteroatoms.

\paragraph{\acrfull{sem}} uses a beam of focused electrons in order to image solid materials. As the electrons interact with the material, electrons and electromagnetic radiation are emitted via various mechanisms. \Acrfull{se} are a result of the ejection of electrons from atoms near the sample surface, and \acrfull{sei} provide high resolution images of surface morphology and texture.\citep{Goldstein2017Scanning} 

\paragraph{\acrfull{bse}} are electrons deflected by nuclear electrostatic charge – degree of deflection increases with nuclear charge. Though this results in much lower resolution images, \acrfull{bed} images the material according to atomic weight, with heavier elements showing up as bright spots. This technique does not identify elements, but can be used to map heavier elements interspersed within a low atomic mass material.\citep{Goldstein2017Scanning}

\paragraph{\acrfull{tem}} differs from \acrshort{sem} in that the electrons are transmitted through the sample as opposed to reflecting off of it. Imaging with \acrshort{tem} allows for much more detailed imaging, down to the atomic scale.\citep{knoll1932elektronenmikroskop}

\paragraph{\acrfull{edx}} relies on the excitation by X-rays of electrons within a sample to identify and quantify its elemental components. It can be coupled with \acrshort{tem} in order to image the dispersion of elements within a sample, this technique is known as \acrshort{edx}-\acrshort{tem}.\citep{Goldstein2017Scanning}

\par \acrshort{sem} images were taken on a JEOL 7100F FEG-SEM with detector set at a working distance of 10.00 mm. SE images were captured with an electron accelerating voltage of 1.00 or 2.00 kV, but this was increased to 15.00 kV for BSE. %find TEM information

\subsection{Porosimetry}\label{ss:porosimetry}

Physical \gls{adsorption}, or \gls{physisorption} is the process whereby molecules of a fluid (the \gls{adsorbate}) are associated with a solid surface (the \gls{adsorbent}) via London forces. Given the molecular diameter, volume, and cross-sectional area of the \gls{adsorbate} certain structural and textural properties of the \gls{adsorbent} can be determined.\citep{Brunauer1938Adsorption} A \gls{physisorption} experiment therefore begins with some known mass of degassed \gls{adsorbent} held under vacuum at constant temperature (often the boiling point of the \gls{adsorbate}). The sample is then dosed with a known quantity of \gls{adsorbent}, and the system is allowed to equilibrate. Once equilibrium is reached the relative pressure of the system is determined, which is used to calculate the quantity of gas adsorbed by the sample. This process of dosing the sample with gas and equilibration is repeated until the sample is saturated or some other predetermined pressure is reached. This often precedes the so-called desorption experiment, whereby \gls{adsorbate} is evacuated from the sample in increments, and the system allowed to equilibrate as previously. The results take the form of an isotherm where quantity adsorbed is plotted against
relative pressure.\citep{Brunauer1938Adsorption, Langmuir1916constitution, Thommes2015Physisorption}

\ce{N2} at \qty{-196}{\degreeCelsius} or \ce{Ar} at \qty{-186}{\degreeCelsius} are the most common \glspl{adsorbate} used in \gls{physisorption} experiments; while \ce{Ar} is recommended by \acrshort{iupac},\citep{Thommes2015Physisorption} the relative expense of maintaining \ce{Ar} at its boiling point means that \ce{N2} is more common. Apart from being inert, cheap and available, an adsorptive must also have minimal polarity so as to not interact more strongly with polar moieties on a heterogeneous surface. Additionally all `open' (see section \ref{ss:pore_filling}) pores of interest should be accessible to the \gls{adsorbate} at the analytical temperature. For these reasons, alternative gases such as \ce{H2}, \ce{O2}, and \ce{CO2} have found applications in recent years.\citep{Jagiello2019Enhanced, Blankenship2022Confirmation, Jagiello2008Characterization}

Irving Langmuir was among the first to develop a theory of \gls{adsorption} of gases onto solid surfaces. The theory assume a reversible reaction between an ideal \gls{adsorbate}, $A_g$ and an \gls{adsorption} site, $S$ to form the adsorbed complex, $A_{ad}$. The reaction proceeds until it reaches equilibrium with constant $K_{eq}$;

\begin{equation}
    \ce{A_g + S <=>[K_{eq}] A_{ad}}
\end{equation}

From this can be derived the Langmuir isotherm, which is a relationship between the fractional occupancy of adsorbed sited, $\theta$ to the partial pressure of the \gls{adsorbate}, $P_A$ and the equilibrium constant; 

\begin{equation}
    \frac{P_A}{Q} = \frac{1}{K_{eq}} + Q_m \, P_A
\end{equation}

where $Q$ and $Q_m$ are the quantity adsorbed, and the quantity of the monolayer, respectively.\citep{Langmuir1916constitution, Langmuir1918adsorption} This can be rearranged to;

\begin{equation}
    \frac{P_A}{Q} = \frac{1}{K_{eq}} + Q_m \, P_A
\end{equation}

The linear plot of $\frac{P_A}{Q}$ against $P_A $ from experimental data will thus reveal the quantity of gas adsorbed on monolayer completion. If the molecular cross-sectional area is known, the surface area, $A_{Langmuir}$ of the sample can be calculated.

Stephen Brunauer, Paul Emmet, and Edward Teller expanded Langmuir theory to account for multilayer \gls{adsorption}, which occurs at higher pressures and temperatures. The following assumptions are made;

	\begin{enumerate}[label=(\arabic*)]
		\item Gas molecules adsorb on solid layers infinitely;
		\item Gas molecules only interact with adjacent layers;
		\item The Langmuir theory can be applied to each layer.
		\item The enthalpy of \gls{adsorption} for the first layer is constant and greater than that for subsequent layers;
		\item After monolayer \gls{adsorption}, the enthalpy of \gls{adsorption} is the same as that of liquefaction.
	\end{enumerate}

The total quantity of gas adsorbed, $Q$ is related the quantity of the monolayer, $Q_m$ by; 

\begin{equation} \label{eq:bet_plot}
    \frac{1}{Q  \left( \frac{P_0}{P} - 1 \right)} = \frac{c-1}{Q_m \, c}  \left( \frac{P}{P_0} \right) + \frac{1}{Q_m \, c}
\end{equation}

Where $c$ is the \acrshort{bet} constant, derived from the heat of \gls{adsorption} of the first layer, $E_1$ and that of the subsequent layers, $E_L$;

\begin{equation}
    c = e^{\frac{E_1 - E_L}{RT}}
\end{equation}

From an isotherm, a plot can then be made of the left hand term in equation \ref{eq:bet_plot} versus $\frac{P}{P_0}$ to yield what is known as the \acrshort{bet} transform. Thus $Q_m$ and $c$ can be determined from the linear portion of this plot. Then, the specific \acrshort{bet} area, $A_{BET}$ of the sample can be determined using the \gls{adsorption} cross-section, $\sigma$ of the adsorptive;

\begin{equation}
    A_{BET} = \frac{Q_m \, N_A \, \sigma}{a}
\end{equation}


Where $N_A$ is the Avogadro constant and $a$ is the mass of the \gls{adsorbent}.\citep{Brunauer1938Adsorption}

For microporous materials, using the \acrshort{bet} method to calculate surface area is problematic for two reasons;

	\begin{enumerate}[label=(\arabic*)]
		\item The initial step in the \gls{adsorption} mechanism is not the formation of the monolayer, but the filling of \glspl{micropore}. This renders \acrshort{bet} theory inaccurate for microporous materials.
		\item 	Following the \acrshort{bet} transform, there are often multiple linear regions of the plot. This means that reported $A_{BET}$ may be inconsistent.
	\end{enumerate}

Despite these problems, $A_{BET}$ continues to be the dominant measure of surface area used for microporous materials. As yet, there is no widespread alternative or extension of \acrshort{bet} theory that solves (1), however the standardisation required according to (2) is most commonly achieved according to a method described by Rouquerol et al, where the \acrshort{bet} plot is transformed by changing the term on the y-axis to $Q \left(1 - \frac{P}{P_0} \right)$. This yields a roughly parabolic graph known as the Rouquerol transform. A pressure range of the \acrshort{bet} transform can then be selected to yield a consistent calculation of $A_{BET}$ according to the following principles;

	\begin{enumerate}[label=(\arabic*)]
		\item The intercept of the original \acrshort{bet} transform must be positive, as a negative intercept would yield a negative value for $c$.
		\item The range selected must correspond to a region of the Rouquerol transform where $Q \left(1 - \frac{P}{P_0} \right)$ constantly increases with $\frac{P}{P_0}$.
		\item $Q_m$ as determined from (1) and (2) can be found in the region of the isotherm selected.\citep{Rouquerol2007Is} 
	\end{enumerate}

\paragraph{In this work} All isotherms were measured on a 3flex analyser (Micromeritics). $A_{BET}$ and total pore volume ($V_t$) were determined using the Rouquerol method (where appropriate), and the single point method respectively. Classical determination of \gls{micropore} volume and surface area were determined using t-plot, with a carbon black STSA thickness curve. All \acrshortpl{psd} are derived using the 2D-NLDFT heterogeneous surface kernel.\citep{Jagiello20132D}.

\subsection{\texorpdfstring{Gravimetric \ce{CO2} uptake}{Gravimetric CO2 uptake}}
The \ce{CO2} uptake of \gls{turbostratic carbon} samples was determined \textit{via} gravimetric analysis. This begins with the degassing of the samples under vacuum followed by precise measurement of the weight of the sample with increasing \ce{CO2} pressure. This yields a \ce{CO2} uptake isotherm, from which molar gravimetric uptake can be read as a function of pressure.

Measurements were taken at either \num{25} or \qty{18}{\degreeCelsius} and up to \num{40} or \qty{20}{\bar}, on Xemis or IGA analysers respectively from Hiden Isochema. 

\section{Computational}
Chapter \ref{ch:pyPUC} describes the use of several python libraries in order to calculate linear regressions between porosity within some range of pore sizes to uptake of \ce{CO2} at some pressure. The main libraries used in this project, known as the python Porosity Uptake Correlator (pyPUC) are \verb|scipy|,\citep{SciPy2020} \verb|numpy|,\citep{numpy2022} \verb|pandas|,\citep{pandas2010} and \verb|pygaps|.\citep{Iacomi2019pyGAPS}

pyPUC is a fairly simple package whose structure is shown in figure \ref{fig:pyPUC_structure}. It is written almost exclusively in python,\citep{python1995} apart from one small bash script.\citep{bash2007} The main functions of pyPUC can be found in \verb|pyPUC/pyPUC/core|, while outside of this is the module \verb|pyPUC/interface.py| which constructs a simple command line interface to run the program, and the bash script \verb|pyPUC-cli| which executes \verb|pyPUC/interface.py|. Finally there is a directory for the \verb|source_data| which should be populated by the user with \acrshortpl{psd} and experimental uptake isotherms for the project in question.

\begin{figure}[ht!]
    \centering
    \begin{forest}
          for tree={
            font=\ttfamily,
            grow'=0,
            child anchor=west,
            parent anchor=south,
            anchor=west,
            calign=first,
            inner xsep=7pt,
            edge path={
              \noexpand\path [draw, \forestoption{edge}]
              (!u.south west) +(7.5pt,0) |- (.child anchor) pic {folder} \forestoption{edge label};
            },
            % style for your file node 
            file/.style={edge path={\noexpand\path [draw, \forestoption{edge}]
              (!u.south west) +(7.5pt,0) |- (.child anchor) \forestoption{edge label};},
              inner xsep=2pt,font=\small\ttfamily
                         },
            before typesetting nodes={
              if n=1
                {insert before={[,phantom]}}
                {}
            },
            fit=band,
            before computing xy={l=15pt},
          }  
        [pyPUC
          [pyPUC
            [core
              [best\_width\_at\_pressure.py,file]
              [psd\_processing.py,file]
              [uptake\_processing.py,file]
              [utils.py,file]
            ]
            [interface.py,file]
          ]
          [source\_data
            [project
              [psd
                [sorptive(s)]
              ]
              [uptake
                [sorptive]
              ]
            ]
          ]
          [pyPUC-cli,file]
        ]
    \end{forest}
    \caption{Structure of key modules and directories in the pyPUC package. There are other components in the github repository but they are not essential to the function of the package.}
    \label{fig:pyPUC_structure}
\end{figure}

The code is well documented, however a brief discussion of the purpose of each of the modules in \verb|pyPUC/pyPUC/core| follows here. Firstly \verb|utils.py| defines utility methods for the other three modules. Most important are the methods \verb|read_data()| and \verb|define_array()|. The former simply reads the data from the \verb|source_data| directory according to input arguments using the \verb|pandas| library,\citep{pandas2010} while the latter is a simple method for defining an array of pressures or pore widths for the modules \verb|uptake_processing| or \verb|psd_processing| using the \verb|numpy| library.\citep{numpy2022} 

\begin{table}[b!]
\centering
\captionof{table}{An example output of processed data from the \texttt{uptake\_processing.py} (a) and \texttt{psd\_processing.py} modules (b). \textit{A}, \textit{B}, \textit{C}, and \textit{D} are the four samples used in this analysis. In the case of (a), the numbers are the loadings of \ce{CO2} on the samples at each of the pressures in column \textit{p}, and for (b) they are the surface areas of the samples within the pore size range defined by $w_{min}$ and $w_{max}$.}
    \begin{subtable}{.5\linewidth}
      \centering
        \caption{}
        \begin{tabular}{l|l|l|l|l}
            p & A & B & C & D \\
            \midrule
            1 & 4.27 & 4.01 & 4.27 & 4.35 \\
            2 & 5.93 & 5.25 & 5.93 & 5.95 \\
            3 & 6.94 & 5.96 & 6.94 & 6.91 \\
        \end{tabular}
    \label{tb:loading_output}
    \end{subtable}%
    \begin{subtable}{.5\linewidth}
      \centering
        \caption{}
        \begin{tabular}{l|l|l|l|l|l}
            $\rm w_{min}$ & $\rm w_{max}$ & A & B & C & D \\
            \midrule
            5 & 4 & 59 & 282 & 238 & 260 \\
            6 & 4 & 401 & 514 & 442 & 465 \\
            6 & 5 & 142 & 232 & 204	& 204 \\
        \end{tabular}
    \label{tb:param_output}
    \end{subtable} 
\label{tb:loading_param_outputs}

\begin{python}
import pandas as pd
import numpy as np

sample_df = pd.read_csv('psd.csv')  # PSD stored in DataFrame 
w_array = [4, 5, 6]  # array of pore widths  
i=0
for wmax in w_array[1:]:  
    for wmin in w_array[w_array<wmax]:  # every possible combination of two w values
        rows_max = np.max(list(np.where(w < wmax)))
        rows_min = np.min(list(np.where(w > wmin)))
        max_value = sample_df.loc[rows_max, 'Vcum']
        min_value = sample_df.loc[rows_min, 'Vcum']
        param = max_value - min_value
        i+=1 # Go through all possible values of wmin for wmax
\end{python}
\captionof{figure}{How the porosity within some pore width range is determined in pyPUC. Note that this is pseudo-code\citep{davis2019pseudocode} as opposed to the actual source code.}
\label{fig:pypuc_porosity}
\end{table}

The \verb|uptake_processing.py| and \verb|psd_processing.py| modules are fairly self-explanatory, in each case simply processing the uptake or \acrshort{psd} data for all samples in \verb|source_data/project|. The outputs from these modules can be seen in figure \ref{tb:loading_param_outputs}. The former attempts to fit each uptake isotherm in the appropriate project in \verb|source_data| to a range of model isotherms and selects the best fit, by using the \verb|modelling| module from the library \verb|pygaps|.\citep{Iacomi2019pyGAPS} These model isotherms are then converted to point isotherms at pressures defined by the user. The pressures and loadings are then stored in a two-dimensional DataFrame, $D_\upsilon$ (see table \ref{tb:loading_output}). The latter reads in the cumulative \acrshortpl{psd} for each sample, and determines the pore volume or surface area within each user-defined pore size range. A demonstration of how this works is shown in figure \ref{fig:pypuc_porosity}. This is done for each sample and stored in the DataFrame $D_\pi$ (see table \ref{tb:param_output}). In either case, the data produced can be stored in memory or output as a \verb|.csv|, alongside a simple report of the data processing as shown in the appendix, figures \ref{fig:loading_report} and \ref{fig:psd_report}.

Finally \verb|best_width_at_pressure.py| takes the two DataFrames generated by \verb|uptake_processing.py| and \verb|psd_processing.py| and uses the \verb|stats.linregress()| method from the \verb|scipy| library\citep{SciPy2020} to perform linear regressions between each row of $D_\upsilon$ and each row of $D_\pi$. That is, if each of $D_\upsilon$ and $D_\pi$ have three rows (1, 2, 3) then a linear regression of row 1 in $D_\upsilon$ will be performed against each row 1, 2 and 3 of $D_\pi$. Then the same is performed for row 2 of $D_\upsilon$, etc.. \verb|scipy.stat.linregress()| then returns the $r^2$ value, slope, and intercept of the regression which is stored in the correlation DataFrame, $D_c$ alongside the values for $w_{min}$, $w_{max}$ and $P$ - an example of this can be seen in table \ref{tb:D_c}. $D_c$ can be reduced in size using the method \verb|correlation_requirements()| which allows rows in the DataFrame to be eliminated according to various arguments. The best pair of $w_{min}$ and $w_{max}$, according to the highest $r^2$ value for each pressure can be selected using the method \verb|make_correlation_df()|, i.e. yielding the optimum pore size region for uptake of the sorptive, $\Omega$.

\begin{table}[h!]
    \centering
    \begin{tabular}{l|l|l|l|l|l|l|l}
        $\rm w_{min}$ & $\rm w_{max}$ & p & $\rm r^2$ & m & c & x & y \\
        \midrule
        \rowcolor{yellow} 4 & 5 & 1 & 0.503 & -0.005 & 5.77 & [259 282 ...] & [4.27 4.01 ...] \\
        \rowcolor{yellow} 4 & 5 & 2 & 0.667 & -0.0157	& 9.85 & [259 282 ...] & [5.93 5.25 ...] \\
        4 & 5 & 3 & 0.691 & -0.0225 & 12.5 & [259 282 ...] & [6.94 5.96 ...] \\
        4 & 6 & 1 & 0.457 & -0.00213 & 5.20 & [401 514 ...] & [4.27 4.01 ...] \\
        4 &	6 & 2 & 0.662 & -0.00591 & 8.46	& [401 514 ...] & [5.93 5.25 ...] \\
        \rowcolor{yellow} 4 &	6 & 3 &	0.696 & -0.00854 & 10.5 & [401 514 ...] & [6.94 5.96 ...] \\
        5 & 6 & 1 & 0.254 & -0.00196 & 4.61 & [142 232 ...] & [4.27 4.01 ...] \\
        5 & 6 & 2 & 0.390 & -0.00561 & 6.86 & [142 232 ...] & [5.93 5.25 ...] \\
        5 & 6 & 3 & 0.413 & -0.00814 & 8.28 & [142 232 ...] & [6.94 5.96 ...] \\
    \end{tabular}
    \caption{Example output of a $D_c$ DataFrame from \ce{CO2} uptake and \acrshort{psd} data in table \ref{tb:loading_param_outputs}. Highlighted rows indicate the regression that yields the optimum pore size range ($\Omega$) for each of the pressures (1, 2, and 3 bar). Columns x and y indicate the surface area and loadings used for the regression, respectively. Values are truncated to save space.}
    \label{tb:D_c}
\end{table}
\bibliographystyle{rsc}
\bibliography{bibliography/bib}
